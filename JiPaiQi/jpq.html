<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ËÆ∞ÁâåÂô®</title>
  <style>
    #box {
      display: flex;
      justify-content: center;
      align-items: stretch;
      user-select: none;
    }

    .card {
      position: relative;
      border-radius: 10px;
      width: 60px;
      margin-top: 20px;
      height: 100px;
      background-color: #f5f5f5;
      margin-right: 10px;
      box-shadow: 0 5px 5px 0 #c9c9c9;
      font-size: 28px;
      padding-left: 10px;
    }

    .card--empty {
      color: #c3c3c3;
      opacity: 0.8;
    }

    .card--chosen {
      margin-top: 0;
    }

    .card::after {
      content: attr(count);
      position: absolute;
      bottom: 2px;
      right: 5px;
      color: #999;
      font-size: 18px;
    }

    .card--warning::after {
      color: red;
      font-weight: bold;
    }

    #btn-box {
      text-align: center;
      margin-top: 30px;
    }

    button {
      padding: 10px 30px;
      border-radius: 60px;
      background-color: orangered;
      color: #fff;
      font-size: 32px;
      border: 0;
      cursor: pointer;
      transition: all ease .3s;
      margin-right: 20px;
      outline: none;
    }

    button:hover {
      background-color: red;
      transform: scale(1.1);
    }
  </style>
</head>

<body>
  <div id="box"></div>
</body>
<script>
  //Â∏∏Èáè
  const arr = ['üëª', 'A', 2, 3, 4, 5, 6, 7, 8, 9, 10, 'J', 'Q', 'K'];
  const nums = [2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4];
  const TYPE_CHOSEN = ' card--chosen';
  const TYPE_WARNING = ' card--warning';
  const TYPE_EMPTY = ' card--empty';
  //ÂÇ®Â≠òÂ∑≤ÁªèÈÄâÊã©
  let chosenArr = [];

  //Ê∑ªÂä†Á±ªÂêç
  function addClass(e, name) {
    if (e.className.indexOf(name) == -1) {
      e.className += name;
    }
  }
  //ÁßªÈô§Á±ªÂêç
  function removeClass(e, name) {
    e.className = e.className.replace(name, '')
  }
  //ÂàùÂßãÂåñÂç°Áâá
  function initCards() {
    let box = document.getElementById('box');
    let frag = document.createDocumentFragment();
    for (let i = 0; i < 14; i++) {
      let ele = document.createElement('div');
      ele.className = 'card' + TYPE_WARNING;
      ele.innerText = arr[i];
      ele.setAttribute('count', nums[i]);
      ele.setAttribute('index', i);
      frag.append(ele)
    }
    box.append(frag);
  }

  //ÂàùÂßãÂåñËæìÂÖ•
  function initSlideInput() {
    let cards = document.getElementsByClassName('card');
    //Èº†Ê†áÊåâ‰∏ãÊó∂Ê≥®ÂÜå
    box.addEventListener('mousedown', installSlideInput)
    //Èº†Ê†áÊä¨Ëµ∑Âç∏ËΩΩ
    box.addEventListener('mouseup', uninstallSlideInput)
    box.addEventListener('mouseleave', uninstallSlideInput)
    //Ê≥®ÂÜåÊªëÂä®ËæìÂÖ•
    function installSlideInput() {
      Array.from(cards).forEach((e) => {
        e.addEventListener('mouseenter', slideSelect)
        e.addEventListener('mouseleave', slideSelect)
      })
    }
    //Âç∏ËΩΩÊªëÂä®ËæìÂÖ•
    function uninstallSlideInput() {
      Array.from(cards).forEach((e) => {
        e.removeEventListener('mouseenter', slideSelect)
        e.removeEventListener('mouseleave', slideSelect)
      })
      submit();
    }
    //ÁÇπÂáªËæìÂÖ•,‰∏ÄÁõ¥ÊúâÊïà
    Array.from(cards).forEach((e) => {
      e.addEventListener('click', function (event) {
        slideSelect(event);
        submit();
      })
    })
    //ÊªëÂä®ËæìÂÖ•
    function slideSelect(event) {
      let idx = event.currentTarget.getAttribute('index');
      if (event.currentTarget.className.indexOf(TYPE_CHOSEN) == -1) {
        addClass(event.currentTarget,TYPE_CHOSEN)
        chosenArr.push(idx);
      }
    }
  }

  //ÈáçÁΩÆÂÖ®ÈÉ®ÁâåÁöÑÁä∂ÊÄÅÔºåÂá∏Ëµ∑->ÂØπÈΩê
  function reset() {
    chosenArr = [];
    let cards = document.getElementsByClassName('card');
    Array.from(cards).forEach((v, i) => {
      removeClass(v,TYPE_CHOSEN)
    });
  }

  //Âá∫Áâå 
  function submit() {
    let cards = document.getElementsByClassName('card');
    chosenArr.forEach((v, i) => {
      cards[v].setAttribute('count', cards[v].getAttribute('count') - 1);
      removeClass(cards[v],TYPE_WARNING);
      if (cards[v].getAttribute('count') < 1) {
        //ÊúÄÂ∞è‰∏∫0,ËÆæÁΩÆ‰∏∫Á©∫Áä∂ÊÄÅ
        cards[v].setAttribute('count', 0);
        addClass(cards[v],TYPE_EMPTY)
      }
    });
    //ÈáçÁΩÆÁä∂ÊÄÅ
    reset();
  }
  //Âè≥ÈîÆÂä†ÁâåÔºåÈò≤Ê≠¢Âá∫ÈîôÁâå
  function addCardCount(e) {
    if (e.getAttribute('count') != undefined) {
      e.setAttribute('count', e.getAttribute('count') - 0 + 1);
    }
    if (e.getAttribute('count') >= nums[e.getAttribute('index')]) {
      e.setAttribute('count', nums[e.getAttribute('index')]);
      addClass(e,TYPE_WARNING)
    } else if (e.getAttribute('count') > 0) {
      removeClass(e,TYPE_EMPTY);
    }
  }

  window.onload = function () {
    document.oncontextmenu = function (event) {
      event.preventDefault();
      if (event.button == 2) {
        addCardCount(event.target)
      }
    };
    initCards();
    initSlideInput();
  }

</script>

</html>